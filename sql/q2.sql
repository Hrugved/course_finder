WITH course_filtered_types AS (
	SELECT * FROM course 
	WHERE (CONV(HEX(course_type_bitmap ^ b'00011100000000000000000000000000'),16,10)=0) in (1)
),
course_filtered_types_branch AS (
	SELECT * FROM course_filtered_types
    WHERE branch in ("AE") 
    -- WHERE branch in (SELECT DISTINCT branch FROM course)
),
course_filtered_types_branch_credits AS (
	SELECT * FROM course_filtered_types_branch
    -- WHERE credits BETWEEN 5 AND 9
    WHERE credits BETWEEN 0 AND 20
),
course_filtered_types_branch_credits_with_clash AS (
	SELECT *, (CONV(HEX(sched_bitmap & b'000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'),16,10)!=0) AS clash FROM course_filtered_types_branch_credits
),
course_filtered_types_branch_credits_with_clash_with_insts AS (
	SELECT * FROM course_filtered_types_branch_credits_with_clash
    INNER JOIN course_instructors USING (course_id)
    INNER JOIN instructor USING (inst_id)
)
SELECT * FROM course_filtered_types_branch_credits_with_clash_with_insts 
WHERE clash in (0,1);

